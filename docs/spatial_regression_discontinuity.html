<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Прикладная эконометрика - 9&nbsp; Пространственная разрывная регрессия</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./synthetic_control.html" rel="next">
<link href="./regression_discontinuity.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./spatial_regression_discontinuity.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Пространственная разрывная регрессия</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Прикладная эконометрика</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="mailto:annastavnychuk@gmail.com" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-at"></i></a>
    <a href="https://github.com/annastavniychuk" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Предисловие</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./experiments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Эксперименты</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./multiple_testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Множественное тестирование гипотез</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bad_control.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Плохой контроль</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./prestratification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Престратификация</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./subclassification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Постстратификация</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./high_dimension_regularization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Регуляризация и большая размерность</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./heterogenous_treatment_effects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Гетерогенные эффекты</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./regression_discontinuity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Разрывная регрессия</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spatial_regression_discontinuity.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Пространственная разрывная регрессия</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./synthetic_control.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Синтетический контроль</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./staggered_adoption.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Ступенчатая разность разностей</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./event_study.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Событийный анализ</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ссылки</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#введение" id="toc-введение" class="nav-link active" data-scroll-target="#введение"><span class="header-section-number">9.1</span> Введение</a></li>
  <li><a href="#работа-с-картами-и-генерация-данных" id="toc-работа-с-картами-и-генерация-данных" class="nav-link" data-scroll-target="#работа-с-картами-и-генерация-данных"><span class="header-section-number">9.2</span> Работа с картами и генерация данных</a></li>
  <li><a href="#генерация-тритмента" id="toc-генерация-тритмента" class="nav-link" data-scroll-target="#генерация-тритмента"><span class="header-section-number">9.3</span> Генерация тритмента</a></li>
  <li><a href="#расстояние-до-отсечки" id="toc-расстояние-до-отсечки" class="nav-link" data-scroll-target="#расстояние-до-отсечки"><span class="header-section-number">9.4</span> Расстояние до отсечки</a></li>
  <li><a href="#проведение-пространственной-оценки-rdd" id="toc-проведение-пространственной-оценки-rdd" class="nav-link" data-scroll-target="#проведение-пространственной-оценки-rdd"><span class="header-section-number">9.5</span> Проведение пространственной оценки RDD</a>
  <ul class="collapse">
  <li><a href="#наивное-расстояние" id="toc-наивное-расстояние" class="nav-link" data-scroll-target="#наивное-расстояние"><span class="header-section-number">9.5.1</span> Наивное расстояние</a></li>
  <li><a href="#параметрические-характеристики" id="toc-параметрические-характеристики" class="nav-link" data-scroll-target="#параметрические-характеристики"><span class="header-section-number">9.5.2</span> Параметрические характеристики</a></li>
  <li><a href="#geographic-regression-discontinuity-grd" id="toc-geographic-regression-discontinuity-grd" class="nav-link" data-scroll-target="#geographic-regression-discontinuity-grd"><span class="header-section-number">9.5.3</span> Geographic Regression Discontinuity (GRD)</a></li>
  </ul></li>
  <li><a href="#робастность" id="toc-робастность" class="nav-link" data-scroll-target="#робастность"><span class="header-section-number">9.6</span> Робастность</a>
  <ul class="collapse">
  <li><a href="#плацебо-граница" id="toc-плацебо-граница" class="nav-link" data-scroll-target="#плацебо-граница"><span class="header-section-number">9.6.1</span> Плацебо граница</a></li>
  <li><a href="#надежность-grd" id="toc-надежность-grd" class="nav-link" data-scroll-target="#надежность-grd"><span class="header-section-number">9.6.2</span> Надежность GRD</a></li>
  <li><a href="#устойчивость-к-спецификации-полинома" id="toc-устойчивость-к-спецификации-полинома" class="nav-link" data-scroll-target="#устойчивость-к-спецификации-полинома"><span class="header-section-number">9.6.3</span> Устойчивость к спецификации полинома</a></li>
  </ul></li>
  <li><a href="#смещение-границ-создание-полигонов-из-линий" id="toc-смещение-границ-создание-полигонов-из-линий" class="nav-link" data-scroll-target="#смещение-границ-создание-полигонов-из-линий"><span class="header-section-number">9.7</span> Смещение границ, создание полигонов из линий</a>
  <ul class="collapse">
  <li><a href="#повороты" id="toc-повороты" class="nav-link" data-scroll-target="#повороты"><span class="header-section-number">9.7.1</span> Повороты</a></li>
  <li><a href="#масштабирование" id="toc-масштабирование" class="nav-link" data-scroll-target="#масштабирование"><span class="header-section-number">9.7.2</span> Масштабирование</a></li>
  <li><a href="#сдвиг" id="toc-сдвиг" class="nav-link" data-scroll-target="#сдвиг"><span class="header-section-number">9.7.3</span> Сдвиг</a></li>
  <li><a href="#всё-вместе" id="toc-всё-вместе" class="nav-link" data-scroll-target="#всё-вместе"><span class="header-section-number">9.7.4</span> Всё вместе</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Пространственная разрывная регрессия</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p><strong>Примечание:</strong></p>
<ul>
<li>Данные материалы являются переводом на русский язык документации пакета <a href="https://axlehner.github.io/SpatialRDD/index.html">SpatialRDD</a> под авторством Alex Lehner</li>
<li>Если вы собираетесь работать с пространственными данными, вам будут полезны следующие материалы:
<ul>
<li><a href="https://tsamsonov.github.io/r-geo-course/">Визуализация и анализ географических данных на языке R (Тимофей Самсонов)</a></li>
<li><a href="https://tsamsonov.github.io/r-spatstat-course/">Пространственная статистика и моделирование на языке R (Тимофей Самсонов)</a></li>
<li><a href="https://geocompr.robinlovelace.net/">Geocomputation with R (Robin Lovelace, Jakub Nowosad, Jannes Muenchow)</a></li>
<li><a href="https://andrewmaclachlan.github.io/CASA0005repo/index.html">CASA0005 Geographic Information Systems and Science (Andy MacLachlan, Adam Dennett)</a></li>
<li>Митапы Европейского университета в Санкт-Петербурге “Введение в пространственный анализ и моделирование в R” <a href="https://meetups.rintro.ru/p/14-may-2022-eu-spb-meetup/">часть 1</a>, <a href="https://meetups.rintro.ru/p/21-may-2022-eu-spb-meetup/">часть 2</a>, <a href="https://meetups.rintro.ru/p/28-may-2022-eu-spb-meetup/">часть 3</a>, <a href="https://meetups.rintro.ru/p/4-june-2022-eu-spb-meetup/">часть 4</a>.</li>
</ul></li>
</ul>
<section id="введение" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="введение"><span class="header-section-number">9.1</span> Введение</h2>
<p>Знакомиться с методом <strong>пространственной разрывной регрессии</strong> мы будем на примере <a href="https://lehner.xyz/pdf/Lehner_Goa_Rootsgender.pdf">статьи</a> Алекса Ленера, который изучал эффекты от колонизации одного из штатов Индии португальцами.</p>
<p>Анализируя индийский штат Гоа, статья использует исторический квазиестественный эксперимент, чтобы продемонстрировать стойкое <strong>влияние португальского (католического) колониализма</strong> в контексте Южной Азии. Ленер изучает три ключевых <strong>социально-экономических фактора</strong>:</p>
<ul>
<li>женскую грамотность,</li>
<li>мужскую грамотность,</li>
<li>соотношение полов.</li>
</ul>
<p><strong>Он установил, что</strong>:</p>
<ul>
<li>Разрывы в грамотности мужчин сходятся примерно в пределах одного поколения.</li>
<li>Разрывы в женской грамотности также сходятся, но гораздо медленнее.</li>
<li>Предпочтения сыновей дочерям оказались гораздо более серьезным – разрывы в соотношении полов вообще не изменились за последние десятилетия.</li>
</ul>
<p>Всё, что написано курсивом ниже не обязательно к прочтению, но делает контекст исследования более понятным.</p>
<p><em>Став первой европейской державой, обогнувшей южную оконечность Африки в 1497 году, португальцы основали столицу своей последующей морской империи в Индийском океане, так называемую Estado da ndia, в Гоа в 1510 году. Это происходило в течение 450 лет и, таким образом, делает этот штат самым длинным постоянно колонизируемым участком земли в молодой истории человечества.</em></p>
<p><em>Первоначально удерживая только портовый город и его окрестности, около 1540 г. они решили занять большие участки земли в направлении север-юг, чтобы создать буферную зону. Эти области составляют Старые завоевания, и именно здесь развернулась уникальная португальская стратегия колонизации. В отличие от других узурпаторов в Индийском океане, таких как голландцы или британцы с их торговыми компаниями, португальцы взаимодействовали с коренными народами.</em></p>
<p><em>Смешанные браки их солдат с местными женщинами поощрялись, чтобы создать лояльное местное население и расширить культурное влияние. Кроме того, были предприняты усилия по обращению населения в католицизм. Их всегда сопровождали монахи и священники, принадлежавшие к определенным религиозным орденам: францисканцы, доминиканцы и, самое главное, иезуиты. Они построили церкви, колледжи, организовали сеть церковно-приходских школ, ввели структурированное образование и даже завезли печатный станок.</em></p>
<p><em>Что еще более важно, лузитанцы значительно изменили положение женщин в обществе сразу после их появления в начале 16 века: сати (или сатти), полигамия и ранние детские браки были запрещены.</em></p>
<p><em>Кроме того, женщинам были предоставлены права собственности, и поэтому с этого момента они могли наследовать. Это было обусловлено вступлением в брак с христианином и, таким образом, служило дополнительным стимулом для обращения в другую веру. Дальнейший разрыв с местными культурными нормами был отмечен тем, что вдовам было разрешено вступать в повторный брак.</em></p>
<p><em>Со временем в результате появилось заметное неравенство между двумя областями, в том числе и в том, что касается инфраструктуры. В то время, когда Индия изгнала португальских колонизаторов в 1961 году, только в нескольких процентах деревень было электричество, а во многих не было государственных школ. Однако правительство Индии вмешалось с крупномасштабными инфраструктурными инвестициями и сумело уравнять предоставление общественных благ по всему Гоа с поразительной скоростью.</em></p>
</section>
<section id="работа-с-картами-и-генерация-данных" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="работа-с-картами-и-генерация-данных"><span class="header-section-number">9.2</span> Работа с картами и генерация данных</h2>
<p>Далее мы будем использовать географические границы штата Гоа из Lehner (2019). Данные, включенные в авторский пакет, содержат:</p>
<ul>
<li>строка cut_off.sf, которая описывает пространственный разрыв (границу колонии)</li>
<li>полигон (многоугольник), определяющий область тритмента</li>
<li>полигон (многоугольник), определяющий всю изучаемую область</li>
</ul>
<p>Подключаем библиотеки:</p>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-1_dc8be6b397db39d0831b7e6fc17e9686">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># library(devtools)</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># devtools::install_github("axlehner/SpatialRDD")</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SpatialRDD)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stargazer) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Почти все пространственные объекты относятся к классу sf из пакета sf. Это означает, что они представляют собой data.frame со специальным столбцом, содержащим геометрию (координаты) для каждой строки.</p>
<p>Большим преимуществом является то, что независимо от того, предпочитаете ли вы base R, dplyr или любой другой способ обработки данных, объект sf можно обрабатывать так же, как стандартный data.frame.</p>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-2_1be68f47cc7b2bcab821dfe43e812988">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(cut_off.sf, polygon_full.sf, polygon_treated.sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Нарисуем границы:</p>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-3_ea526468110e0bf0a720ad7db7c32ad0">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(polygon_full.sf) <span class="sc">+</span> <span class="fu">tm_polygons</span>() <span class="sc">+</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(polygon_treated.sf) <span class="sc">+</span> <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"grey"</span>) <span class="sc">+</span> </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(cut_off.sf) <span class="sc">+</span> <span class="fu">tm_lines</span>(<span class="at">col =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="spatial_regression_discontinuity_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Выше мы видим простую карту, где полигон тритмента закрашен более темным цветом, а cutoff обозначена красным цветом.</p>
<p>Давайте смоделируем несколько случайных точек внутри полигона, описывающего всю изучаемую область:</p>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-4_3867bd30de046f813d5878b1b16e3fcf">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1088</span>) </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>points_samp.sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_sample</span>(polygon_full.sf, <span class="dv">1000</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>points_samp.sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_sf</span>(points_samp.sf) <span class="co"># делаем его объектом sf, потому что st_sample создал только столбец координат (sfc)</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>points_samp.sf<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(points_samp.sf) <span class="co"># добавим уникальный ID каждому наблюдению</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>И снова всё нарисуем:</p>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-5_9a7ea8c27d3665021d2123abbbae0ae7">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(points_samp.sf) <span class="sc">+</span> <span class="fu">tm_dots</span>() <span class="sc">+</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(cut_off.sf) <span class="sc">+</span> <span class="fu">tm_lines</span>(<span class="at">col =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="spatial_regression_discontinuity_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="генерация-тритмента" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="генерация-тритмента"><span class="header-section-number">9.3</span> Генерация тритмента</h2>
<p>Теперь воспользуемся первой функцией пакета SpatialRDD – assign_treated().</p>
<p>Она выполняет пространственное разграничение и возвращает вектор-столбец, который содержит 0 или 1, в зависимости от того, находится ли наблюдение внутри или снаружи области обработки.</p>
<p>Таким образом, мы просто добавляем его как новый столбец к объекту точек. Для функции требуется имя объекта точек, имя полигона, определяющего обрабатываемую область, и идентификатор, который однозначно идентифицирует каждое наблюдение в объекте точек:</p>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-6_7039a62896eb861f770b56fba4dc4570">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>points_samp.sf<span class="sc">$</span>treated <span class="ot">&lt;-</span> <span class="fu">assign_treated</span>(points_samp.sf, polygon_treated.sf, <span class="at">id =</span> <span class="st">"id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Снова рисуем:</p>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-7_7e5d2a437b35058ae147f286f1d1895d">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(points_samp.sf) <span class="sc">+</span> <span class="fu">tm_dots</span>(<span class="st">"treated"</span>, <span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(cut_off.sf) <span class="sc">+</span> <span class="fu">tm_lines</span>(<span class="at">col =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="spatial_regression_discontinuity_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Для того, чтобы что-то посчитать, нам нужна зависимая переменная. Назовем эту переменную образованием, готорая будет измерять уровень грамотности, который колеблется от 0 до 1 (от 0%, что означает, что все неграмотны, до 100%, что означает, что все в популяции умеют читать и писать).</p>
<p>Мы предполагаем, что юниты, называемые деревнями, в тритмент полигоне в среднем имеют более высокий уровень грамотности, потому что они подверглись колонизации.</p>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-8_68b3e780b255b76cc43c3dada87b743b">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># first we define a variable for the number of "treated" and control which makes the code more readable in the future</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># сначала сохраним отдельно количество тритмент и контрольных деревень, чтобы дальше было удобнее писать код</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>NTr <span class="ot">&lt;-</span> <span class="fu">length</span>(points_samp.sf<span class="sc">$</span>id[points_samp.sf<span class="sc">$</span>treated <span class="sc">==</span> <span class="dv">1</span>])</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>NCo <span class="ot">&lt;-</span> <span class="fu">length</span>(points_samp.sf<span class="sc">$</span>id[points_samp.sf<span class="sc">$</span>treated <span class="sc">==</span> <span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Создаём зависимую переменную:</p>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-9_7b5d99946505073c1b89372a9f37c288">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># тритмент деревни получают на 10 процентных пунктов более высокий уровень грамотности</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>points_samp.sf<span class="sc">$</span>education[points_samp.sf<span class="sc">$</span>treated <span class="sc">==</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fl">0.7</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>points_samp.sf<span class="sc">$</span>education[points_samp.sf<span class="sc">$</span>treated <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="fl">0.6</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># добавляем немного шума, иначе мы бы получили коэффициенты регрессии без стандартных ошибок</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>points_samp.sf<span class="sc">$</span>education[points_samp.sf<span class="sc">$</span>treated <span class="sc">==</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(NTr, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> .<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  points_samp.sf<span class="sc">$</span>education[points_samp.sf<span class="sc">$</span>treated <span class="sc">==</span> <span class="dv">1</span>]</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>points_samp.sf<span class="sc">$</span>education[points_samp.sf<span class="sc">$</span>treated <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(NCo, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> .<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  points_samp.sf<span class="sc">$</span>education[points_samp.sf<span class="sc">$</span>treated <span class="sc">==</span> <span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Также создадим плацебо результат без скачка в разрыве:</p>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-10_a2a3d07f4449960b29a1952c24e128a7">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>points_samp.sf<span class="sc">$</span>placebo <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(points_samp.sf), <span class="at">mean =</span> <span class="dv">1</span>, <span class="at">sd =</span> .<span class="dv">25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Посмотрим распределение зависимой переменной:</p>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-11_90ed987d8cd7a0a75c5e5a834be3fdd4">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(points_samp.sf, <span class="fu">aes</span>(<span class="at">x =</span> education)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> .<span class="dv">01</span>) <span class="sc">+</span> <span class="fu">facet_grid</span>(treated <span class="sc">~</span> .)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="spatial_regression_discontinuity_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Из приведенных выше гистограмм видно, что нам удалось создать различные средние группы. Это также подтверждается простой одномерной регрессией <span class="math inline">\(y_i=\alpha+\beta \mathbb{1}(\text { treated })_i+\varepsilon_i\)</span> :</p>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-12_e616883e64dc38abdb316ac8716de80e">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(<span class="fu">lm</span>(education <span class="sc">~</span> treated, <span class="at">data =</span> points_samp.sf),</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>     <span class="fu">lm</span>(placebo   <span class="sc">~</span> treated, <span class="at">data =</span> points_samp.sf)) <span class="sc">%&gt;%</span> stargazer<span class="sc">::</span><span class="fu">stargazer</span>(<span class="at">type =</span> <span class="st">"text"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
===========================================================
                                   Dependent variable:     
                               ----------------------------
                                  education      placebo   
                                     (1)           (2)     
-----------------------------------------------------------
treated1                          0.105***        0.035*   
                                   (0.008)       (0.020)   
                                                           
Constant                          0.601***       0.994***  
                                   (0.004)       (0.009)   
                                                           
-----------------------------------------------------------
Observations                        1,000         1,000    
R2                                  0.157         0.003    
Adjusted R2                         0.156         0.002    
Residual Std. Error (df = 998)      0.100         0.260    
F Statistic (df = 1; 998)        185.992***       3.072*   
===========================================================
Note:                           *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</code></pre>
</div>
</div>
<p>Среднее значение в контрольных деревнях составляет 0,6, а в тритмент деревнях образование в среднем на 0,1 больше (10 процентных пунктов).</p>
</section>
<section id="расстояние-до-отсечки" class="level2" data-number="9.4">
<h2 data-number="9.4" class="anchored" data-anchor-id="расстояние-до-отсечки"><span class="header-section-number">9.4</span> Расстояние до отсечки</h2>
<p>Следующим важным шагом, прежде чем мы начнем проводить надлежащий пространственный RDD-анализ, является определение того, насколько далеко каждая из этих точек находится от границы отсечки.</p>
<p>Здесь мы просто используем функцию st_distance() из sf, которая возвращает вектор с единицами измерения (которые мы должны преобразовать в действительные числа с помощью as.numeric()):</p>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-13_8f50f82935a95849a1a1e4fade8e0c30">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>points_samp.sf<span class="sc">$</span>dist2cutoff <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(sf<span class="sc">::</span><span class="fu">st_distance</span>(points_samp.sf, cut_off.sf))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Это позволяет нам теперь исследовать деревни только в пределах определенного диапазона, скажем, 3 километра вокруг нашей границы:</p>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-14_3b4734a3e2a6b653722640d5cfdfd531">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(points_samp.sf[points_samp.sf<span class="sc">$</span>dist2cutoff <span class="sc">&lt;</span> <span class="dv">3000</span>, ]) <span class="sc">+</span> <span class="fu">tm_dots</span>(<span class="st">"education"</span>, <span class="at">palette =</span> <span class="st">"RdYlGn"</span>, <span class="at">size =</span> .<span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(cut_off.sf) <span class="sc">+</span> <span class="fu">tm_lines</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="spatial_regression_discontinuity_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Далее мы можем оценить регрессию только в пределах полосы в 3 км (эта постановка уже начинает напоминать идею классического RDD):</p>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-15_32238a74b08520f1899b38e9544ffdcd">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(education <span class="sc">~</span> treated, <span class="at">data =</span> points_samp.sf[points_samp.sf<span class="sc">$</span>dist2cutoff <span class="sc">&lt;</span> <span class="dv">3000</span>, ]) <span class="sc">%&gt;%</span> stargazer<span class="sc">::</span><span class="fu">stargazer</span>(<span class="at">type =</span> <span class="st">"text"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
===============================================
                        Dependent variable:    
                    ---------------------------
                             education         
-----------------------------------------------
treated1                     0.090***          
                              (0.015)          
                                               
Constant                     0.612***          
                              (0.011)          
                                               
-----------------------------------------------
Observations                    159            
R2                             0.186           
Adjusted R2                    0.181           
Residual Std. Error      0.095 (df = 157)      
F Statistic           35.810*** (df = 1; 157)  
===============================================
Note:               *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</code></pre>
</div>
</div>
</section>
<section id="проведение-пространственной-оценки-rdd" class="level2" data-number="9.5">
<h2 data-number="9.5" class="anchored" data-anchor-id="проведение-пространственной-оценки-rdd"><span class="header-section-number">9.5</span> Проведение пространственной оценки RDD</h2>
<p>Теперь мы шаг за шагом рассмотрим все потенциальные (параметрические и непараметрические) способы, с помощью которых можно получить точечные оценки для пространственных RDD.</p>
<section id="наивное-расстояние" class="level3" data-number="9.5.1">
<h3 data-number="9.5.1" class="anchored" data-anchor-id="наивное-расстояние"><span class="header-section-number">9.5.1</span> Наивное расстояние</h3>
<p>Для «наивной» оценки (KeeleTitiunik2015), означающей, что пространственное измерение практически не учитывается, мы сначала определяем переменную distrunning, которая делает расстояния в обработанных областях отрицательными, так что наше двумерное отсечение становится равным 0.</p>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-16_6a3a087eee84d8cefec551425e2251d9">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>points_samp.sf<span class="sc">$</span>distrunning <span class="ot">&lt;-</span> points_samp.sf<span class="sc">$</span>dist2cutoff</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># сделаем running variable отрицательной для наблюдений слева от cutoff, но на карте это соответсвтует области справа (контрольные деревни)</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>points_samp.sf<span class="sc">$</span>distrunning[points_samp.sf<span class="sc">$</span>treated <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> points_samp.sf<span class="sc">$</span>distrunning[points_samp.sf<span class="sc">$</span>treated <span class="sc">==</span> <span class="dv">0</span>]</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> points_samp.sf, <span class="fu">aes</span>(<span class="at">x =</span> distrunning, <span class="at">y =</span> education)) <span class="sc">+</span> </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="spatial_regression_discontinuity_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Тогда точечная оценка “классической” непараметрической локальной линейной регрессии, выполненной с помощью пакета rdrobust, выглядит так:</p>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-17_691440a361629db48cc2e001f8c74abd">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rdrobust)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">rdrobust</span>(points_samp.sf<span class="sc">$</span>education, points_samp.sf<span class="sc">$</span>distrunning, <span class="at">c =</span> <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sharp RD estimates using local polynomial regression.

Number of Obs.                 1000
BW type                       mserd
Kernel                   Triangular
VCE method                       NN

Number of Obs.                  785          215
Eff. Number of Obs.             127          100
Order est. (p)                    1            1
Order bias  (q)                   2            2
BW est. (h)                4248.546     4248.546
BW bias (b)                6601.220     6601.220
rho (h/b)                     0.644        0.644
Unique Obs.                     785          215

=============================================================================
        Method     Coef. Std. Err.         z     P&gt;|z|      [ 95% C.I. ]       
=============================================================================
  Conventional     0.116     0.025     4.580     0.000     [0.066 , 0.166]     
        Robust         -         -     4.089     0.000     [0.064 , 0.181]     
=============================================================================</code></pre>
</div>
</div>
<ul>
<li>По выборке:
<ul>
<li><code>Number of Obs.</code> количество наблюдений</li>
<li><code>BW type</code> определяет используемую процедуру выбора ширины окна.</li>
<li><code>Kernel</code> это функция ядра, используемая для построения локально-полиномиальных оценок.</li>
<li><code>VCE method</code> тип процедуры, используемой для вычисления оценки матрицы дисперсии-ковариации (робастные ошибки).</li>
</ul></li>
<li>По группам (тритмент и контроль):
<ul>
<li><code>Number of Obs.</code></li>
<li><code>Eff. Number of Obs.</code></li>
<li><code>Order est. (p)</code> указывает порядок локального многочлена, используемого для построения точечной оценки; по умолчанию p = 1 (локальная линейная регрессия).</li>
<li><code>Order bias  (q)</code> задает порядок локального полинома, используемого для построения коррекции смещения; по умолчанию q = 2 (локальная квадратичная регрессия).</li>
<li><code>BW est. (h)</code> задает окно, используемое для создания средства оценки точек RD. Если не указано иного, то h вычисляется сопутствующей командой rdbwselect.</li>
<li><code>BW bias (b)</code> задает ширину окна, используемую для создания средства оценки коррекции смещения. Если не указано иное, то b вычисляется сопутствующей командой rdbwselect.</li>
<li><code>rho (h/b)</code> по умолчанию rho = 1, если h указано, а b нет.</li>
<li><code>Unique Obs.</code> количество уникальных наблюдений.</li>
</ul></li>
<li>Оценка:
<ul>
<li><code>Conventional</code> обычные оценки RD с обычными стандартными ошибками.</li>
<li><code>Robust</code> оценки с поправкой на погрешность с робастными стандартными ошибками</li>
</ul></li>
</ul>
<p>Посмотрим картинку эффектов в зависимости от ширины окна:</p>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-18_2d2cbb11ce3116cc78579819347765e6">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rdplot</span>(points_samp.sf<span class="sc">$</span>education, points_samp.sf<span class="sc">$</span>distrunning, <span class="at">c =</span> <span class="dv">0</span>, <span class="at">ci =</span> <span class="dv">95</span>, </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">kernel =</span> <span class="st">"triangular"</span>, <span class="at">y.label =</span> <span class="st">"education"</span>, <span class="at">x.label =</span> <span class="st">"distance to border"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="spatial_regression_discontinuity_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Для оценки RDD в R в настоящее время существует три пакета: RDD, rddtools и rddapp (основанный на RDD); при этом последний является наиболее современным, он оценивает <strong>различные спецификации</strong>:</p>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-19_eb69f3ccc803ce7729524fe70547f062">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rddapp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-20_301521187a96ff17e919276611ec89c7">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">rd_est</span>(education <span class="sc">~</span> distrunning, <span class="at">data =</span> points_samp.sf, <span class="at">t.design =</span> <span class="st">"g"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
rd_est(formula = education ~ distrunning, data = points_samp.sf, 
    t.design = "g")

ITT used:
FALSE

Type:
sharp 

Estimates:
            Bandwidth  Observations  Estimate  Std. Error  lower.CL  upper.CL
Linear         NA      1000          0.08474   0.01321     0.05884   0.1106  
Quadratic      NA      1000          0.09778   0.01888     0.06078   0.1348  
Cubic          NA      1000          0.11587   0.02409     0.06864   0.1631  
Opt         15055       652          0.09259   0.01540     0.06240   0.1228  
Half-Opt     7527       415          0.10276   0.01957     0.06440   0.1411  
Double-Opt  30110       975          0.08809   0.01351     0.06161   0.1146  
            z value  Pr(&gt;|z|)      
Linear      6.413    1.425e-10  ***
Quadratic   5.179    2.226e-07  ***
Cubic       4.809    1.517e-06  ***
Opt         6.011    1.848e-09  ***
Half-Opt    5.250    1.519e-07  ***
Double-Opt  6.519    7.082e-11  ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Confidence interval used:  0.95 </code></pre>
</div>
</div>
<p>Нарисуем несколько разных спецификаций на одном графике. Здесь мы произвольно выбираем одну параметрическую и одну непараметрическую оценку, включая доверительные интервалы и выбранные вручную размеры окон:</p>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-21_a2246fe6386b77daabc1eaf53190df5b">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">rd_est</span>(education <span class="sc">~</span> distrunning, <span class="at">data =</span> points_samp.sf, <span class="at">t.design =</span> <span class="st">"g"</span>), <span class="at">fit_line =</span> <span class="fu">c</span>(<span class="st">"quadratic"</span>, <span class="st">"optimal"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="spatial_regression_discontinuity_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="параметрические-характеристики" class="level3" data-number="9.5.2">
<h3 data-number="9.5.2" class="anchored" data-anchor-id="параметрические-характеристики"><span class="header-section-number">9.5.2</span> Параметрические характеристики</h3>
<p>Этот метод, популяризированный Dell2010 в его job market paper, исследует только наблюдения в пределах определенного расстояния вокруг границы с использованием (полу-)параметрического подхода.</p>
<p>По существу, он отличается от предыдущих оценок только введением сегментов границы. Они используются для “within” оценки, позволяющей использовать различные точки пересечения для каждой из этих категорий сегментов, чтобы, среди прочего, облегчить проблему пропущенных переменных.</p>
<p>В качестве альтернативы этому подходу с фиксированными эффектами мы могли бы использовать набор фиктивных моделей для каждого сегмента регрессии. А затем просто бы усреднили по ним переменную интереса.</p>
<p>Кроме того, нас также может заинтересовать коэффициент каждого сегмента, чтобы сделать вывод о потенциальной неоднородности наряду с разрывом нашей регрессии.</p>
<p>Вычислительно требовательная функция border_segment() нуждается только в слое точек и координатах границы в качестве входных данных. Последний параметр функции позволяет нам определить, сколько сегментов мы хотим. Как и в случае с функцией assign_treated(), результатом является вектор факторов.</p>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-22_1396aea2e8d97fe4566408b9993b8b69">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>points_samp.sf<span class="sc">$</span>segment10 <span class="ot">&lt;-</span> <span class="fu">border_segment</span>(points_samp.sf, cut_off.sf, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Starting to create 10 border segments with an approximate length of 13 kilometres each.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>points_samp.sf<span class="sc">$</span>segment15 <span class="ot">&lt;-</span> <span class="fu">border_segment</span>(points_samp.sf, cut_off.sf, <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Starting to create 15 border segments with an approximate length of 9 kilometres each.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>points_samp.sf<span class="sc">$</span>segment15 <span class="ot">&lt;-</span> <span class="fu">border_segment</span>(points_samp.sf, cut_off.sf, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Starting to create 5 border segments with an approximate length of 26 kilometres each.</code></pre>
</div>
</div>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-23_55f9efc73dec2455a19d282f7c61c3e7">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(points_samp.sf) <span class="sc">+</span> <span class="fu">tm_dots</span>(<span class="st">"segment10"</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(cut_off.sf) <span class="sc">+</span> <span class="fu">tm_lines</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="spatial_regression_discontinuity_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(points_samp.sf) <span class="sc">+</span> <span class="fu">tm_dots</span>(<span class="st">"segment15"</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(cut_off.sf) <span class="sc">+</span> <span class="fu">tm_lines</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="spatial_regression_discontinuity_files/figure-html/unnamed-chunk-23-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Важно всегда отображать сегменты (категории фиксированных эффектов) на карте. border_segment() уже дает исследователю представление о том, насколько осмысленным был выбор количества сегментов.</p>
<p>В приведенном выше примере у нас есть сегмент на каждые 13 километров, что кажется не слишком разумным. Однако мы могли видеть, что некоторые из сегментов содержат очень мало наблюдений, что нежелательно.</p>
<p>Таким образом, в следующем примере мы выбираем меньше сегментов, что приводит к большему количеству наблюдений с каждой стороны границы для каждого сегмента и, следовательно, к более значимым точечным оценкам:</p>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-24_b22df65427b633b9a9792ce24fb47c9b">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>points_samp.sf<span class="sc">$</span>segment5 <span class="ot">&lt;-</span> <span class="fu">border_segment</span>(points_samp.sf, cut_off.sf, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Starting to create 5 border segments with an approximate length of 26 kilometres each.</code></pre>
</div>
</div>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-25_8294d68c1ade4e96d0c50ea4ad841adc">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(points_samp.sf) <span class="sc">+</span> <span class="fu">tm_dots</span>(<span class="st">"segment5"</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span> <span class="fu">tm_shape</span>(cut_off.sf) <span class="sc">+</span> <span class="fu">tm_lines</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="spatial_regression_discontinuity_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Простые оценки МНК с использованием сегментов, которые мы только что получили в качестве фиксированных эффектов, показывают следующие различия:</p>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-26_5b32d1b6abb757b625b3add63b7c84e2">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lfe)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-27_c3ed34e0a57160b1bd59a98eaadc2908">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(lfe<span class="sc">::</span><span class="fu">felm</span>(education <span class="sc">~</span> treated <span class="sc">|</span> <span class="fu">factor</span>(segment15) <span class="sc">|</span> <span class="dv">0</span> <span class="sc">|</span> <span class="dv">0</span>, <span class="at">data =</span> points_samp.sf[points_samp.sf<span class="sc">$</span>dist2cutoff <span class="sc">&lt;</span> <span class="dv">3000</span>, ]),</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>lfe<span class="sc">::</span><span class="fu">felm</span>(education <span class="sc">~</span> treated <span class="sc">|</span> <span class="fu">factor</span>(segment5) <span class="sc">|</span> <span class="dv">0</span> <span class="sc">|</span> <span class="dv">0</span>, <span class="at">data =</span> points_samp.sf[points_samp.sf<span class="sc">$</span>dist2cutoff <span class="sc">&lt;</span> <span class="dv">3000</span>, ])</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> stargazer<span class="sc">::</span><span class="fu">stargazer</span>(<span class="at">type =</span> <span class="st">"text"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
===========================================================
                                   Dependent variable:     
                               ----------------------------
                                        education          
                                    (1)            (2)     
-----------------------------------------------------------
treated1                          0.089***      0.089***   
                                  (0.015)        (0.015)   
                                                           
-----------------------------------------------------------
Observations                        159            159     
R2                                 0.248          0.248    
Adjusted R2                        0.224          0.224    
Residual Std. Error (df = 153)     0.092          0.092    
===========================================================
Note:                           *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</code></pre>
</div>
</div>
<p>Доверительные интервалы обеих точечных оценок перекрываются, однако видно, что выбор фиксированных эффектов может оказать существенное влияние.</p>
<p>Мы получаем точечную оценку, которая (что неудивительно, поскольку у нас есть процесс генерации данных, который однороден в пространстве) очень похожа на ту, которую мы получили из простой регрессии МНК с самого начала.</p>
<p>По сравнению с точечной оценкой «классического RD», которую мы получили из непараметрической локальной линейной регрессии из пакета rdrobust, точечная оценка из нашей регрессии с фиксированными эффектами немного более консервативна. Но на глаз мы можем определить, что средний эффект находится где-то около 0,1, а это означает, что уровень грамотности на 10 процентных пунктов выше в тритмент деревнях. Что соотвествует тому, что мы замоделировали в данных.</p>
</section>
<section id="geographic-regression-discontinuity-grd" class="level3" data-number="9.5.3">
<h3 data-number="9.5.3" class="anchored" data-anchor-id="geographic-regression-discontinuity-grd"><span class="header-section-number">9.5.3</span> Geographic Regression Discontinuity (GRD)</h3>
<p>Наконец, мы переходим к полноценному дизайну разрыва географической регрессии (GRD) (KeeleTitiunik2015). Функция spacerd() включает оценку RD с двумя running variable, а также позволяет выполнять оценку для каждой граничной точки (boundarypoint) («GRDDseries»).</p>
<p>Это позволяет нам визуализировать эффект лечения в нескольких точках отсечки и, таким образом, сделать вывод о потенциальной неоднородности эффекта. И, самое главное, оценить надежность самого GRD.</p>
<p>Прежде всего, мы должны разрезать границу на равные сегменты. Для каждого из этих отрезков, а точнее граничных точек, мы в дальнейшем получим точечную оценку. Для функции discretise_border() просто требуется объект sf, который содержит границу и количество желаемых граничных точек:</p>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-28_afb9fe729df53949c2e5bf3aeb3471e1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>borderpoints.sf <span class="ot">&lt;-</span> <span class="fu">discretise_border</span>(<span class="at">cutoff =</span> cut_off.sf, <span class="at">n =</span> <span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Starting to create 50 borderpoints from the given set of borderpoints. Approximately every 3 kilometres we can run an estimation then.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>borderpoints.sf<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(borderpoints.sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-29_fa6ccba01b1279fb4d9b82ae30ed41fa">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(points_samp.sf[points_samp.sf<span class="sc">$</span>dist2cutoff <span class="sc">&lt;</span> <span class="dv">3000</span>, ]) <span class="sc">+</span> <span class="fu">tm_dots</span>(<span class="st">"education"</span>, <span class="at">palette =</span> <span class="st">"RdYlGn"</span>, <span class="at">size =</span> .<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(cut_off.sf) <span class="sc">+</span> <span class="fu">tm_lines</span>() <span class="sc">+</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(borderpoints.sf) <span class="sc">+</span> <span class="fu">tm_symbols</span>(<span class="at">shape =</span> <span class="dv">4</span>, <span class="at">size =</span> .<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="spatial_regression_discontinuity_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Для построения только таблицы результатов было бы предпочтительнее выбрать в качестве вывода только data.frame (spatial.object = F).</p>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-30_ed0f631b14ba4046e6f3725f191a20e9">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">spatialrd</span>(<span class="at">y =</span> <span class="st">"education"</span>, <span class="at">data =</span> points_samp.sf, <span class="at">cutoff.points =</span> borderpoints.sf, <span class="at">treated =</span> <span class="st">"treated"</span>, <span class="at">minobs =</span> <span class="dv">10</span>, <span class="at">spatial.object =</span> F)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 6%">
<col style="width: 9%">
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 9%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">Point</th>
<th style="text-align: right;">Estimate</th>
<th style="text-align: right;">SE_Conv</th>
<th style="text-align: right;">SE_Rob</th>
<th style="text-align: right;">p_Conv</th>
<th style="text-align: right;">p_Rob</th>
<th style="text-align: right;">Ntr</th>
<th style="text-align: right;">Nco</th>
<th style="text-align: right;">bw_l</th>
<th style="text-align: right;">bw_r</th>
<th style="text-align: right;">CI_Conv_l</th>
<th style="text-align: right;">CI_Conv_u</th>
<th style="text-align: right;">CI_Rob_l</th>
<th style="text-align: right;">CI_Rob_u</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">14.2</td>
<td style="text-align: right;">14.2</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.21</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.24</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.14</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">57</td>
<td style="text-align: right;">15.2</td>
<td style="text-align: right;">15.2</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.27</td>
<td style="text-align: right;">-0.01</td>
<td style="text-align: right;">0.30</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">103</td>
<td style="text-align: right;">84</td>
<td style="text-align: right;">19.9</td>
<td style="text-align: right;">19.9</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.21</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.24</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.22</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">16.0</td>
<td style="text-align: right;">16.0</td>
<td style="text-align: right;">-0.02</td>
<td style="text-align: right;">0.17</td>
<td style="text-align: right;">-0.05</td>
<td style="text-align: right;">0.20</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.22</td>
<td style="text-align: right;">104</td>
<td style="text-align: right;">73</td>
<td style="text-align: right;">17.3</td>
<td style="text-align: right;">17.3</td>
<td style="text-align: right;">-0.02</td>
<td style="text-align: right;">0.17</td>
<td style="text-align: right;">-0.04</td>
<td style="text-align: right;">0.19</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">0.22</td>
<td style="text-align: right;">112</td>
<td style="text-align: right;">84</td>
<td style="text-align: right;">20.9</td>
<td style="text-align: right;">20.9</td>
<td style="text-align: right;">-0.01</td>
<td style="text-align: right;">0.15</td>
<td style="text-align: right;">-0.04</td>
<td style="text-align: right;">0.16</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.20</td>
<td style="text-align: right;">108</td>
<td style="text-align: right;">62</td>
<td style="text-align: right;">18.9</td>
<td style="text-align: right;">18.9</td>
<td style="text-align: right;">-0.01</td>
<td style="text-align: right;">0.13</td>
<td style="text-align: right;">-0.03</td>
<td style="text-align: right;">0.13</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.18</td>
<td style="text-align: right;">93</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">17.1</td>
<td style="text-align: right;">17.1</td>
<td style="text-align: right;">-0.01</td>
<td style="text-align: right;">0.15</td>
<td style="text-align: right;">-0.03</td>
<td style="text-align: right;">0.16</td>
</tr>
<tr class="odd">
<td style="text-align: right;">9</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">77</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">14.1</td>
<td style="text-align: right;">14.1</td>
<td style="text-align: right;">-0.02</td>
<td style="text-align: right;">0.24</td>
<td style="text-align: right;">-0.03</td>
<td style="text-align: right;">0.27</td>
</tr>
<tr class="even">
<td style="text-align: right;">10</td>
<td style="text-align: right;">0.13</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">69</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">12.3</td>
<td style="text-align: right;">12.3</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.26</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.30</td>
</tr>
<tr class="odd">
<td style="text-align: right;">11</td>
<td style="text-align: right;">0.18</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">11.1</td>
<td style="text-align: right;">11.1</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.32</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.35</td>
</tr>
<tr class="even">
<td style="text-align: right;">12</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">0.13</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">9.6</td>
<td style="text-align: right;">9.6</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.48</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.53</td>
</tr>
<tr class="odd">
<td style="text-align: right;">13</td>
<td style="text-align: right;">0.32</td>
<td style="text-align: right;">0.14</td>
<td style="text-align: right;">0.15</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">8.2</td>
<td style="text-align: right;">8.2</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.60</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.65</td>
</tr>
<tr class="even">
<td style="text-align: right;">14</td>
<td style="text-align: right;">0.20</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">9.5</td>
<td style="text-align: right;">9.5</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.35</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.40</td>
</tr>
<tr class="odd">
<td style="text-align: right;">15</td>
<td style="text-align: right;">0.15</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">8.8</td>
<td style="text-align: right;">8.8</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.27</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.32</td>
</tr>
<tr class="even">
<td style="text-align: right;">16</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">86</td>
<td style="text-align: right;">13.7</td>
<td style="text-align: right;">13.7</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.28</td>
</tr>
<tr class="odd">
<td style="text-align: right;">17</td>
<td style="text-align: right;">0.18</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">10.7</td>
<td style="text-align: right;">10.7</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.29</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.33</td>
</tr>
<tr class="even">
<td style="text-align: right;">18</td>
<td style="text-align: right;">0.15</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">98</td>
<td style="text-align: right;">14.5</td>
<td style="text-align: right;">14.5</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.26</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.29</td>
</tr>
<tr class="odd">
<td style="text-align: right;">19</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">96</td>
<td style="text-align: right;">102</td>
<td style="text-align: right;">16.4</td>
<td style="text-align: right;">16.4</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.20</td>
<td style="text-align: right;">-0.01</td>
<td style="text-align: right;">0.21</td>
</tr>
<tr class="even">
<td style="text-align: right;">20</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: right;">85</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">13.9</td>
<td style="text-align: right;">13.9</td>
<td style="text-align: right;">-0.01</td>
<td style="text-align: right;">0.21</td>
<td style="text-align: right;">-0.04</td>
<td style="text-align: right;">0.23</td>
</tr>
<tr class="odd">
<td style="text-align: right;">21</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.22</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">13.2</td>
<td style="text-align: right;">13.2</td>
<td style="text-align: right;">-0.02</td>
<td style="text-align: right;">0.19</td>
<td style="text-align: right;">-0.05</td>
<td style="text-align: right;">0.20</td>
</tr>
<tr class="even">
<td style="text-align: right;">22</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.21</td>
<td style="text-align: right;">0.35</td>
<td style="text-align: right;">73</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">13.3</td>
<td style="text-align: right;">13.3</td>
<td style="text-align: right;">-0.04</td>
<td style="text-align: right;">0.19</td>
<td style="text-align: right;">-0.07</td>
<td style="text-align: right;">0.20</td>
</tr>
<tr class="odd">
<td style="text-align: right;">23</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">96</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">14.1</td>
<td style="text-align: right;">14.1</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.20</td>
<td style="text-align: right;">-0.02</td>
<td style="text-align: right;">0.21</td>
</tr>
<tr class="even">
<td style="text-align: right;">24</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.14</td>
<td style="text-align: right;">103</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">14.5</td>
<td style="text-align: right;">14.5</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.21</td>
<td style="text-align: right;">-0.03</td>
<td style="text-align: right;">0.23</td>
</tr>
<tr class="odd">
<td style="text-align: right;">25</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.23</td>
<td style="text-align: right;">83</td>
<td style="text-align: right;">57</td>
<td style="text-align: right;">13.6</td>
<td style="text-align: right;">13.6</td>
<td style="text-align: right;">-0.02</td>
<td style="text-align: right;">0.22</td>
<td style="text-align: right;">-0.06</td>
<td style="text-align: right;">0.24</td>
</tr>
<tr class="even">
<td style="text-align: right;">26</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">0.43</td>
<td style="text-align: right;">0.64</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">11.7</td>
<td style="text-align: right;">11.7</td>
<td style="text-align: right;">-0.09</td>
<td style="text-align: right;">0.20</td>
<td style="text-align: right;">-0.13</td>
<td style="text-align: right;">0.22</td>
</tr>
<tr class="odd">
<td style="text-align: right;">27</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.56</td>
<td style="text-align: right;">0.80</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">9.6</td>
<td style="text-align: right;">9.6</td>
<td style="text-align: right;">-0.11</td>
<td style="text-align: right;">0.21</td>
<td style="text-align: right;">-0.17</td>
<td style="text-align: right;">0.22</td>
</tr>
<tr class="even">
<td style="text-align: right;">30</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.88</td>
<td style="text-align: right;">0.95</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">9.2</td>
<td style="text-align: right;">9.2</td>
<td style="text-align: right;">-0.17</td>
<td style="text-align: right;">0.19</td>
<td style="text-align: right;">-0.22</td>
<td style="text-align: right;">0.21</td>
</tr>
<tr class="odd">
<td style="text-align: right;">31</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.20</td>
<td style="text-align: right;">0.35</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">61</td>
<td style="text-align: right;">12.8</td>
<td style="text-align: right;">12.8</td>
<td style="text-align: right;">-0.04</td>
<td style="text-align: right;">0.19</td>
<td style="text-align: right;">-0.08</td>
<td style="text-align: right;">0.21</td>
</tr>
<tr class="even">
<td style="text-align: right;">32</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.14</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">10.6</td>
<td style="text-align: right;">10.6</td>
<td style="text-align: right;">-0.01</td>
<td style="text-align: right;">0.22</td>
<td style="text-align: right;">-0.03</td>
<td style="text-align: right;">0.24</td>
</tr>
<tr class="odd">
<td style="text-align: right;">33</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">102</td>
<td style="text-align: right;">68</td>
<td style="text-align: right;">14.9</td>
<td style="text-align: right;">14.9</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.17</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.20</td>
</tr>
<tr class="even">
<td style="text-align: right;">34</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">109</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">14.8</td>
<td style="text-align: right;">14.8</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.18</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.20</td>
</tr>
<tr class="odd">
<td style="text-align: right;">35</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">11.3</td>
<td style="text-align: right;">11.3</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.19</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.22</td>
</tr>
<tr class="even">
<td style="text-align: right;">36</td>
<td style="text-align: right;">0.17</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">8.6</td>
<td style="text-align: right;">8.6</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.23</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">0.25</td>
</tr>
<tr class="odd">
<td style="text-align: right;">37</td>
<td style="text-align: right;">0.15</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">8.6</td>
<td style="text-align: right;">8.6</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.26</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.29</td>
</tr>
<tr class="even">
<td style="text-align: right;">38</td>
<td style="text-align: right;">0.15</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">108</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">13.4</td>
<td style="text-align: right;">13.4</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.29</td>
</tr>
<tr class="odd">
<td style="text-align: right;">39</td>
<td style="text-align: right;">0.13</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">167</td>
<td style="text-align: right;">64</td>
<td style="text-align: right;">16.5</td>
<td style="text-align: right;">16.5</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.22</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.26</td>
</tr>
<tr class="even">
<td style="text-align: right;">40</td>
<td style="text-align: right;">0.14</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">137</td>
<td style="text-align: right;">62</td>
<td style="text-align: right;">15.1</td>
<td style="text-align: right;">15.1</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.24</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.28</td>
</tr>
<tr class="odd">
<td style="text-align: right;">41</td>
<td style="text-align: right;">0.18</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">61</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">11.1</td>
<td style="text-align: right;">11.1</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.30</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.34</td>
</tr>
<tr class="even">
<td style="text-align: right;">42</td>
<td style="text-align: right;">0.15</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">57</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">10.9</td>
<td style="text-align: right;">10.9</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.26</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.30</td>
</tr>
<tr class="odd">
<td style="text-align: right;">43</td>
<td style="text-align: right;">0.13</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">152</td>
<td style="text-align: right;">64</td>
<td style="text-align: right;">15.5</td>
<td style="text-align: right;">15.5</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.22</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.25</td>
</tr>
<tr class="even">
<td style="text-align: right;">44</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">99</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">13.3</td>
<td style="text-align: right;">13.3</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.22</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">45</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">111</td>
<td style="text-align: right;">59</td>
<td style="text-align: right;">13.8</td>
<td style="text-align: right;">13.8</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.20</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.23</td>
</tr>
<tr class="even">
<td style="text-align: right;">46</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">112</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">13.4</td>
<td style="text-align: right;">13.4</td>
<td style="text-align: right;">-0.02</td>
<td style="text-align: right;">0.23</td>
<td style="text-align: right;">-0.02</td>
<td style="text-align: right;">0.28</td>
</tr>
<tr class="odd">
<td style="text-align: right;">47</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">0.13</td>
<td style="text-align: right;">130</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">15.5</td>
<td style="text-align: right;">15.5</td>
<td style="text-align: right;">-0.02</td>
<td style="text-align: right;">0.18</td>
<td style="text-align: right;">-0.03</td>
<td style="text-align: right;">0.21</td>
</tr>
<tr class="even">
<td style="text-align: right;">48</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">0.18</td>
<td style="text-align: right;">233</td>
<td style="text-align: right;">75</td>
<td style="text-align: right;">23.0</td>
<td style="text-align: right;">23.0</td>
<td style="text-align: right;">-0.02</td>
<td style="text-align: right;">0.15</td>
<td style="text-align: right;">-0.03</td>
<td style="text-align: right;">0.18</td>
</tr>
<tr class="odd">
<td style="text-align: right;">49</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.17</td>
<td style="text-align: right;">0.23</td>
<td style="text-align: right;">162</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">19.6</td>
<td style="text-align: right;">19.6</td>
<td style="text-align: right;">-0.03</td>
<td style="text-align: right;">0.15</td>
<td style="text-align: right;">-0.04</td>
<td style="text-align: right;">0.17</td>
</tr>
<tr class="even">
<td style="text-align: right;">50</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.24</td>
<td style="text-align: right;">0.35</td>
<td style="text-align: right;">112</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">17.6</td>
<td style="text-align: right;">17.6</td>
<td style="text-align: right;">-0.03</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">-0.05</td>
<td style="text-align: right;">0.14</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Средний тритмент эффект определяется как среднее значение всех точечных оценок.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(results<span class="sc">$</span>Estimate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.116875</code></pre>
</div>
</div>
<p>Получили 0.12, практически так, как и замоделировали.</p>
<p>Для построения серии подобных оценок и визуализации в пространстве каждой точечной оценки нам необходим пространственный объект. Все это включено в функцию plotspatialrd().</p>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-32_0897b0a2c61d5e90fe6a034e5f1401c7">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">spatialrd</span>(<span class="at">y =</span> <span class="st">"education"</span>, <span class="at">data =</span> points_samp.sf, <span class="at">cutoff.points =</span> borderpoints.sf, <span class="at">treated =</span> <span class="st">"treated"</span>, <span class="at">minobs =</span> <span class="dv">10</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plotspatialrd</span>(results, <span class="at">map =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="spatial_regression_discontinuity_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Можно вывести и более компактно:</p>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-33_f69da36f9920a296f08bd1ab1a1af8a4">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotspatialrd</span>(results, <span class="at">map =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="spatial_regression_discontinuity_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="робастность" class="level2" data-number="9.6">
<h2 data-number="9.6" class="anchored" data-anchor-id="робастность"><span class="header-section-number">9.6</span> Робастность</h2>
<p>В работах с разрывной регрессией исследователь обычно также должен показать, что результаты устойчивы к различным спецификациям и параметрам. Пакет SpatialRDD предлагает множество возможностей, которые экономят время и упрощают воспроизводимость. Этот набор инструментов для смещения и перемещения вокруг границ и последующего назначения тритмента (плацебо) на самом деле настолько эффективен, что его можно использовать во многих других условиях дизайна исследований за пределами географических RD.</p>
<section id="плацебо-граница" class="level3" data-number="9.6.1">
<h3 data-number="9.6.1" class="anchored" data-anchor-id="плацебо-граница"><span class="header-section-number">9.6.1</span> Плацебо граница</h3>
<p>Мы применяем сдвиг на 3000 метров по координатам x и y границы.</p>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-34_b1ef63f5f35040068e41eb975f851e08">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>placebocut_off<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">shift_border</span>(cut_off.sf, <span class="at">operation =</span> <span class="st">"shift"</span>, <span class="at">shift =</span> <span class="fu">c</span>(<span class="dv">3000</span>, <span class="dv">3000</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pay attention to CRS! If you work in lon/lat then degrees have to be provided. Local UTM CRS is preferable!</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>placeboborderpoints<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">discretise_border</span>(<span class="at">cutoff =</span> placebocut_off<span class="fl">.1</span>, <span class="at">n =</span> <span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Starting to create 50 borderpoints from the given set of borderpoints. Approximately every 3 kilometres we can run an estimation then.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(points_samp.sf) <span class="sc">+</span> <span class="fu">tm_dots</span>(<span class="st">"treated"</span>, <span class="at">palette =</span> <span class="st">"Set1"</span>)  <span class="sc">+</span> <span class="fu">tm_shape</span>(placeboborderpoints<span class="fl">.1</span>) <span class="sc">+</span> <span class="fu">tm_symbols</span>(<span class="at">shape =</span> <span class="dv">4</span>, <span class="at">size =</span> .<span class="dv">3</span>) <span class="sc">+</span> <span class="fu">tm_shape</span>(placebocut_off<span class="fl">.1</span>) <span class="sc">+</span> <span class="fu">tm_lines</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="spatial_regression_discontinuity_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>После сдвига границы нам теперь нужно повторно присвоить новый тритмент, чтобы выполнить регрессии.</p>
<p>Мы создаем новые полигоны с нуля с помощью функции cutoff2polygons(). В нашем случае нам не нужно огибать углы контрфактического многоугольника, потому что оба конца отсечки идут на запад. Просто убедитесь, что конечные точки выбраны таким образом, чтобы все наблюдения, которые должны быть в группе «тритмент плацебо», также фактически находились внутри этого результирующего многоугольника.</p>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-35_7d8ea831a53c23988bbb35ab299db457">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>placebo.poly<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">cutoff2polygon</span>(<span class="at">data =</span> points_samp.sf, <span class="at">cutoff =</span> placebocut_off<span class="fl">.1</span>, <span class="at">orientation =</span> <span class="fu">c</span>(<span class="st">"west"</span>, <span class="st">"west"</span>), <span class="at">endpoints =</span> <span class="fu">c</span>(.<span class="dv">8</span>, .<span class="dv">2</span>))</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(placebo.poly<span class="fl">.1</span>) <span class="sc">+</span> <span class="fu">tm_polygons</span>(<span class="at">alpha =</span> .<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="spatial_regression_discontinuity_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Наконец, мы должны снова использовать функцию assign_treated():</p>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-36_d9e74555cd354b77f0e12f096fb0f6c0">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>points_samp.sf<span class="sc">$</span>treated1 <span class="ot">&lt;-</span> <span class="fu">assign_treated</span>(<span class="at">data =</span> points_samp.sf, <span class="at">polygon =</span> placebo.poly<span class="fl">.1</span>, <span class="at">id =</span> <span class="st">"id"</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(points_samp.sf<span class="sc">$</span>treated <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> points_samp.sf<span class="sc">$</span>treated1 <span class="sc">==</span> <span class="dv">1</span>) <span class="co"># количество деревень, которые изменили статус тритмента</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 60</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(points_samp.sf) <span class="sc">+</span> <span class="fu">tm_dots</span>(<span class="st">"treated1"</span>, <span class="at">palette =</span> <span class="st">"Set1"</span>)  <span class="sc">+</span> <span class="fu">tm_shape</span>(placeboborderpoints<span class="fl">.1</span>) <span class="sc">+</span> <span class="fu">tm_symbols</span>(<span class="at">shape =</span> <span class="dv">4</span>, <span class="at">size =</span> .<span class="dv">3</span>) <span class="sc">+</span> <span class="fu">tm_shape</span>(placebocut_off<span class="fl">.1</span>) <span class="sc">+</span> <span class="fu">tm_lines</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="spatial_regression_discontinuity_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>После повторного нанесения точек мы можем визуально сделать вывод, что правильно перераспределили группы в тритмент и контроль.</p>
<p>Далее мы можем подсчитать количество деревень, которые меняют свой статус. Это помогает нам решить, было ли смещение границы достаточно большим (например, если переключится только несколько наблюдений, то мы ожидаем, что это практически не повлияет на наши точечные оценки, и поэтому такое упражнение на надежность можно назвать не очень значимым).</p>
<p>В данном случае поменялось 60 деревень. Учитывая начальное количество обработанных наблюдений, это кажется изменением достаточно большой величины и, следовательно, значимым упражнением на надежность.</p>
</section>
<section id="надежность-grd" class="level3" data-number="9.6.2">
<h3 data-number="9.6.2" class="anchored" data-anchor-id="надежность-grd"><span class="header-section-number">9.6.2</span> Надежность GRD</h3>
<p>Наконец, мы снова делаем то же самое упражнение, описанное выше, и запускаем непараметрическую спецификацию на многих граничных точках, чтобы аппроксимировать многократный эффект воздействия. Ряд колеблется около 0 и не имеет ни одной значимой оценки, поэтому можно сделать вывод, что методология работает.</p>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-37_97f92907f276ba29a44e844a5f95bb50">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>results1 <span class="ot">&lt;-</span> <span class="fu">spatialrd</span>(<span class="at">y =</span> <span class="st">"education"</span>, <span class="at">data =</span> points_samp.sf, <span class="at">cutoff.points =</span> placeboborderpoints<span class="fl">.1</span>, <span class="at">treated =</span> <span class="st">"treated1"</span>, <span class="at">minobs =</span> <span class="dv">10</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plotspatialrd</span>(results1, <span class="at">map =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="spatial_regression_discontinuity_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="устойчивость-к-спецификации-полинома" class="level3" data-number="9.6.3">
<h3 data-number="9.6.3" class="anchored" data-anchor-id="устойчивость-к-спецификации-полинома"><span class="header-section-number">9.6.3</span> Устойчивость к спецификации полинома</h3>
<p>Наконец, мы также запускаем наше плацебо-упражнение с параметрической спецификацией.</p>
<p>К сожалению, OLS с фиксированными эффектами не так чувствительна, когда дело доходит до обнаружения сдвига границы. Коэффициент по-прежнему находится на грани значимости. В этом случае мы должны были отодвинуть границу на 1-2 километра дальше, чтобы сделать ее незначительной.</p>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-38_0692b30bcb34844bf3c26476868edaa1">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>points_samp.sf<span class="sc">$</span>segment.<span class="fl">1.5</span> <span class="ot">&lt;-</span> <span class="fu">border_segment</span>(points_samp.sf, placebocut_off<span class="fl">.1</span>, <span class="dv">5</span>) <span class="co"># assigning new segments based on now cutoff</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Starting to create 5 border segments with an approximate length of 26 kilometres each.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>points_samp.sf<span class="sc">$</span>dist2cutoff1 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(sf<span class="sc">::</span><span class="fu">st_distance</span>(points_samp.sf, placebocut_off<span class="fl">.1</span>)) <span class="co"># recompute distance to new placebo cutoff</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(education <span class="sc">~</span> treated1, <span class="at">data =</span> points_samp.sf[points_samp.sf<span class="sc">$</span>dist2cutoff1 <span class="sc">&lt;</span> <span class="dv">3000</span>, ]),</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  lfe<span class="sc">::</span><span class="fu">felm</span>(education <span class="sc">~</span> treated1 <span class="sc">|</span> <span class="fu">factor</span>(segment.<span class="fl">1.5</span>) <span class="sc">|</span> <span class="dv">0</span> <span class="sc">|</span> <span class="dv">0</span>, <span class="at">data =</span> points_samp.sf[points_samp.sf<span class="sc">$</span>dist2cutoff1 <span class="sc">&lt;</span> <span class="dv">3000</span>, ])</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> stargazer<span class="sc">::</span><span class="fu">stargazer</span>(<span class="at">type =</span> <span class="st">"text"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
========================================================
                            Dependent variable:         
                    ------------------------------------
                                 education              
                            OLS               felm      
                            (1)               (2)       
--------------------------------------------------------
treated11                  0.021             0.018      
                          (0.015)           (0.015)     
                                                        
Constant                 0.617***                       
                          (0.010)                       
                                                        
--------------------------------------------------------
Observations                177               177       
R2                         0.011             0.032      
Adjusted R2                0.005             0.004      
Residual Std. Error  0.100 (df = 175)   0.100 (df = 171)
F Statistic         1.944 (df = 1; 175)                 
========================================================
Note:                        *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</code></pre>
</div>
</div>
</section>
</section>
<section id="смещение-границ-создание-полигонов-из-линий" class="level2" data-number="9.7">
<h2 data-number="9.7" class="anchored" data-anchor-id="смещение-границ-создание-полигонов-из-линий"><span class="header-section-number">9.7</span> Смещение границ, создание полигонов из линий</h2>
<p>Одной из самых утомительных задач, когда речь идет о географических RDD, является выполнение так называемых проверок плацебо. С ними нужно показать, что постулируемый эффект исчезает при смещении границы RD. Иными словами, тритмент должен быть незначительным при оценке RD на любой другой границе.</p>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-39_517bbbf0da89b16a468e312ef10dcab4">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SpatialRDD)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(cut_off.sf, polygon_full.sf, polygon_treated.sf)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1088</span>) <span class="co"># set a seed to make the results replicable</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>points_samp.sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_sample</span>(polygon_full.sf, <span class="dv">1000</span>)</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>points_samp.sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_sf</span>(points_samp.sf) <span class="co"># make it an sf object bc st_sample only created the geometry list-column (sfc)</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>points_samp.sf<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(points_samp.sf) <span class="co"># add a unique ID to each observation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="повороты" class="level3" data-number="9.7.1">
<h3 data-number="9.7.1" class="anchored" data-anchor-id="повороты"><span class="header-section-number">9.7.1</span> Повороты</h3>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-40_77b353ddabcb2f18640e0178aefa09c1">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>tm_rotate.sf10 <span class="ot">&lt;-</span> <span class="fu">shift_border</span>(<span class="at">border =</span> cut_off.sf, <span class="at">operation =</span> <span class="st">"rotate"</span>, <span class="at">angle =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pay attention to CRS! If you work in lon/lat then degrees have to be provided. Local UTM CRS is preferable!</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>tm_rotate.sf25 <span class="ot">&lt;-</span> <span class="fu">shift_border</span>(<span class="at">border =</span> cut_off.sf, <span class="at">operation =</span> <span class="st">"rotate"</span>, <span class="at">angle =</span> <span class="dv">25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pay attention to CRS! If you work in lon/lat then degrees have to be provided. Local UTM CRS is preferable!</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>tm_rotate.sf45 <span class="ot">&lt;-</span> <span class="fu">shift_border</span>(<span class="at">border =</span> cut_off.sf, <span class="at">operation =</span> <span class="st">"rotate"</span>, <span class="at">angle =</span> <span class="dv">45</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pay attention to CRS! If you work in lon/lat then degrees have to be provided. Local UTM CRS is preferable!</code></pre>
</div>
</div>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-41_e47fcb8d4bab549e928464d7464b3a85">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(polygon_full.sf) <span class="sc">+</span> <span class="fu">tm_polygons</span>() <span class="sc">+</span> <span class="fu">tm_shape</span>(cut_off.sf) <span class="sc">+</span> <span class="fu">tm_lines</span>() <span class="sc">+</span> </span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(tm_rotate.sf10) <span class="sc">+</span> <span class="fu">tm_lines</span>(<span class="at">col =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(tm_rotate.sf25) <span class="sc">+</span> <span class="fu">tm_lines</span>(<span class="at">col =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(tm_rotate.sf45) <span class="sc">+</span> <span class="fu">tm_lines</span>(<span class="at">col =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="spatial_regression_discontinuity_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="масштабирование" class="level3" data-number="9.7.2">
<h3 data-number="9.7.2" class="anchored" data-anchor-id="масштабирование"><span class="header-section-number">9.7.2</span> Масштабирование</h3>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-42_a832c7d1f2738cf2fbb3331c055a38aa">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>tm_scale.sf<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">shift_border</span>(<span class="at">border =</span> cut_off.sf, <span class="at">operation =</span> <span class="st">"scale"</span>, <span class="at">scale =</span> .<span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pay attention to CRS! If you work in lon/lat then degrees have to be provided. Local UTM CRS is preferable!</code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>tm_scale.sf<span class="fl">.7</span> <span class="ot">&lt;-</span> <span class="fu">shift_border</span>(<span class="at">border =</span> cut_off.sf, <span class="at">operation =</span> <span class="st">"scale"</span>, <span class="at">scale =</span> .<span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pay attention to CRS! If you work in lon/lat then degrees have to be provided. Local UTM CRS is preferable!</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>tm_scale.sf1<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">shift_border</span>(<span class="at">border =</span> cut_off.sf, <span class="at">operation =</span> <span class="st">"scale"</span>, <span class="at">scale =</span> <span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pay attention to CRS! If you work in lon/lat then degrees have to be provided. Local UTM CRS is preferable!</code></pre>
</div>
</div>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-43_fbeb9dc6933d0c88ec5b3fe3f9588821">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(polygon_full.sf) <span class="sc">+</span> <span class="fu">tm_polygons</span>() <span class="sc">+</span> <span class="fu">tm_shape</span>(cut_off.sf) <span class="sc">+</span> <span class="fu">tm_lines</span>() <span class="sc">+</span> </span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(tm_scale.sf<span class="fl">.4</span>) <span class="sc">+</span> <span class="fu">tm_lines</span>(<span class="at">col =</span> <span class="st">"blue"</span>) <span class="sc">+</span> </span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(tm_scale.sf<span class="fl">.7</span>) <span class="sc">+</span> <span class="fu">tm_lines</span>(<span class="at">col =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(tm_scale.sf1<span class="fl">.5</span>) <span class="sc">+</span> <span class="fu">tm_lines</span>(<span class="at">col =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="spatial_regression_discontinuity_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="сдвиг" class="level3" data-number="9.7.3">
<h3 data-number="9.7.3" class="anchored" data-anchor-id="сдвиг"><span class="header-section-number">9.7.3</span> Сдвиг</h3>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-44_38c95633cf7d20554b3bd80cb5b42438">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>tm_shift.sf3 <span class="ot">&lt;-</span> <span class="fu">shift_border</span>(<span class="at">border =</span> cut_off.sf, <span class="at">operation =</span> <span class="st">"shift"</span>, <span class="at">shift =</span> <span class="fu">c</span>(<span class="dv">3000</span>, <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pay attention to CRS! If you work in lon/lat then degrees have to be provided. Local UTM CRS is preferable!</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>tm_shift.sf6 <span class="ot">&lt;-</span> <span class="fu">shift_border</span>(<span class="at">border =</span> cut_off.sf, <span class="at">operation =</span> <span class="st">"shift"</span>, <span class="at">shift =</span> <span class="fu">c</span>(<span class="dv">6000</span>, <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pay attention to CRS! If you work in lon/lat then degrees have to be provided. Local UTM CRS is preferable!</code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>tm_shift.sf_4 <span class="ot">&lt;-</span> <span class="fu">shift_border</span>(<span class="at">border =</span> cut_off.sf, <span class="at">operation =</span> <span class="st">"shift"</span>, <span class="at">shift =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">4000</span>, <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pay attention to CRS! If you work in lon/lat then degrees have to be provided. Local UTM CRS is preferable!</code></pre>
</div>
</div>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-45_ec29557b7dc93fcbefd0f90903a415f5">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(polygon_full.sf) <span class="sc">+</span> <span class="fu">tm_polygons</span>() <span class="sc">+</span> <span class="fu">tm_shape</span>(cut_off.sf) <span class="sc">+</span> <span class="fu">tm_lines</span>() <span class="sc">+</span> </span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(tm_shift.sf3) <span class="sc">+</span> <span class="fu">tm_lines</span>(<span class="at">col =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(tm_shift.sf6) <span class="sc">+</span> <span class="fu">tm_lines</span>(<span class="at">col =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(tm_shift.sf_4) <span class="sc">+</span> <span class="fu">tm_lines</span>(<span class="at">col =</span> <span class="st">"blue"</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="spatial_regression_discontinuity_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-46_56e1266b35dc5379661fe7444b0326eb">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>tm_shift.sf_42 <span class="ot">&lt;-</span> <span class="fu">shift_border</span>(<span class="at">border =</span> cut_off.sf, <span class="at">operation =</span> <span class="st">"shift"</span>, <span class="at">shift =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">4000</span>, <span class="sc">-</span><span class="dv">2000</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pay attention to CRS! If you work in lon/lat then degrees have to be provided. Local UTM CRS is preferable!</code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>tm_shift.sf_44 <span class="ot">&lt;-</span> <span class="fu">shift_border</span>(<span class="at">border =</span> cut_off.sf, <span class="at">operation =</span> <span class="st">"shift"</span>, <span class="at">shift =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">4000</span>, <span class="sc">-</span><span class="dv">4000</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pay attention to CRS! If you work in lon/lat then degrees have to be provided. Local UTM CRS is preferable!</code></pre>
</div>
</div>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-47_3cec04e156c52dad575c181292c782b6">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(polygon_full.sf) <span class="sc">+</span> <span class="fu">tm_polygons</span>() <span class="sc">+</span> <span class="fu">tm_shape</span>(cut_off.sf) <span class="sc">+</span> <span class="fu">tm_lines</span>() <span class="sc">+</span> </span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(tm_shift.sf_42) <span class="sc">+</span> <span class="fu">tm_lines</span>(<span class="at">col =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(tm_shift.sf_44) <span class="sc">+</span> <span class="fu">tm_lines</span>(<span class="at">col =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(tm_shift.sf_4) <span class="sc">+</span> <span class="fu">tm_lines</span>(<span class="at">col =</span> <span class="st">"blue"</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="spatial_regression_discontinuity_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="всё-вместе" class="level3" data-number="9.7.4">
<h3 data-number="9.7.4" class="anchored" data-anchor-id="всё-вместе"><span class="header-section-number">9.7.4</span> Всё вместе</h3>
<p>Правильная граница плацебо в идеале включает в себя как сдвиг, так и изменение масштаба:</p>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-48_4d507e4472c43d60b64c754b8af139e2">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>tm_placebo.sf1 <span class="ot">&lt;-</span> <span class="fu">shift_border</span>(<span class="at">border =</span> cut_off.sf, <span class="at">operation =</span> <span class="fu">c</span>(<span class="st">"shift"</span>, <span class="st">"scale"</span>), <span class="at">shift =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5000</span>, <span class="sc">-</span><span class="dv">3000</span>), <span class="at">scale =</span> .<span class="dv">85</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pay attention to CRS! If you work in lon/lat then degrees have to be provided. Local UTM CRS is preferable!</code></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>tm_placebo.sf2 <span class="ot">&lt;-</span> <span class="fu">shift_border</span>(<span class="at">border =</span> cut_off.sf, <span class="at">operation =</span> <span class="fu">c</span>(<span class="st">"shift"</span>, <span class="st">"scale"</span>), <span class="at">shift =</span> <span class="fu">c</span>(<span class="dv">4000</span>, <span class="dv">2000</span>), <span class="at">scale =</span> <span class="fl">1.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pay attention to CRS! If you work in lon/lat then degrees have to be provided. Local UTM CRS is preferable!</code></pre>
</div>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>tm_placebo.sf3 <span class="ot">&lt;-</span> <span class="fu">shift_border</span>(<span class="at">border =</span> cut_off.sf, <span class="at">operation =</span> <span class="fu">c</span>(<span class="st">"shift"</span>, <span class="st">"scale"</span>), <span class="at">shift =</span> <span class="fu">c</span>(<span class="dv">6000</span>, <span class="dv">3000</span>), <span class="at">scale =</span> <span class="fl">1.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pay attention to CRS! If you work in lon/lat then degrees have to be provided. Local UTM CRS is preferable!</code></pre>
</div>
</div>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-49_e44fcbcea87d46468695c94972f0b95e">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(polygon_full.sf) <span class="sc">+</span> <span class="fu">tm_polygons</span>() <span class="sc">+</span> <span class="fu">tm_shape</span>(cut_off.sf) <span class="sc">+</span> <span class="fu">tm_lines</span>() <span class="sc">+</span> </span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(tm_placebo.sf1) <span class="sc">+</span> <span class="fu">tm_lines</span>(<span class="at">col =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(tm_placebo.sf2) <span class="sc">+</span> <span class="fu">tm_lines</span>(<span class="at">col =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(tm_placebo.sf3) <span class="sc">+</span> <span class="fu">tm_lines</span>(<span class="at">col =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="spatial_regression_discontinuity_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-50_012fee5622d42c96118944fab6f355a8">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>tm_shift.sf <span class="ot">&lt;-</span> <span class="fu">shift_border</span>(<span class="at">border =</span> cut_off.sf, <span class="at">operation =</span> <span class="fu">c</span>(<span class="st">"shift"</span>, <span class="st">"rotate"</span>, <span class="st">"scale"</span>), </span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">shift =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10000</span>, <span class="sc">-</span><span class="dv">1000</span>), <span class="at">angle =</span> <span class="dv">0</span>, <span class="at">scale =</span> .<span class="dv">9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pay attention to CRS! If you work in lon/lat then degrees have to be provided. Local UTM CRS is preferable!</code></pre>
</div>
</div>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-51_49e62ddb6d537e494879fb4dbcf38ecb">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(cut_off.sf) <span class="sc">+</span> <span class="fu">tm_lines</span>() <span class="sc">+</span> <span class="fu">tm_shape</span>(tm_shift.sf) <span class="sc">+</span> <span class="fu">tm_lines</span>(<span class="at">col =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="spatial_regression_discontinuity_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>И соответствующие полигоны для назначения тритмента:</p>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-52_e8becb398e64bd5f6d6bc1e876897f62">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>polygon1 <span class="ot">&lt;-</span> <span class="fu">cutoff2polygon</span>(<span class="at">data =</span> points_samp.sf, <span class="at">cutoff =</span> tm_placebo.sf1, <span class="at">orientation =</span> <span class="fu">c</span>(<span class="st">"west"</span>, <span class="st">"west"</span>), <span class="at">endpoints =</span> <span class="fu">c</span>(.<span class="dv">8</span>, .<span class="dv">2</span>), <span class="co"># corners = 0,</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>                           <span class="co">#     crs = 32643</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>                           )</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>polygon2 <span class="ot">&lt;-</span> <span class="fu">cutoff2polygon</span>(<span class="at">data =</span> points_samp.sf, <span class="at">cutoff =</span> tm_placebo.sf2, <span class="at">orientation =</span> <span class="fu">c</span>(<span class="st">"west"</span>, <span class="st">"west"</span>), <span class="at">endpoints =</span> <span class="fu">c</span>(.<span class="dv">8</span>, .<span class="dv">2</span>), <span class="co"># corners = 0,</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>                           <span class="co">#     crs = 32643</span></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>                           )</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>polygon3 <span class="ot">&lt;-</span> <span class="fu">cutoff2polygon</span>(<span class="at">data =</span> points_samp.sf, <span class="at">cutoff =</span> tm_placebo.sf3, <span class="at">orientation =</span> <span class="fu">c</span>(<span class="st">"west"</span>, <span class="st">"west"</span>), <span class="at">endpoints =</span> <span class="fu">c</span>(.<span class="dv">8</span>, .<span class="dv">2</span>), <span class="co"># corners = 0,</span></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>                           <span class="co">#     crs = 32643</span></span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>                           )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="spatial_regression_discontinuity_cache/html/unnamed-chunk-53_fcea15ce078632928c9e578a85ecfa90">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(polygon_full.sf) <span class="sc">+</span> <span class="fu">tm_polygons</span>() <span class="sc">+</span> </span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(polygon_treated.sf) <span class="sc">+</span> <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"grey"</span>) <span class="sc">+</span> </span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(cut_off.sf) <span class="sc">+</span> <span class="fu">tm_lines</span>(<span class="at">col =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(polygon1) <span class="sc">+</span> <span class="fu">tm_polygons</span>(<span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(polygon2) <span class="sc">+</span> <span class="fu">tm_polygons</span>(<span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(polygon3) <span class="sc">+</span> <span class="fu">tm_polygons</span>(<span class="at">alpha =</span> .<span class="dv">3</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="spatial_regression_discontinuity_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./regression_discontinuity.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Разрывная регрессия</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./synthetic_control.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Синтетический контроль</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>